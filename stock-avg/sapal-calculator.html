<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì‚¬íŒ”ì‚¬íŒ” ë‹¨íƒ€ ê³„ì‚°ê¸°</title>
  <style>
    body {
      font-family: 'Pretendard', sans-serif;
      padding: 20px;
      background: #f8f9fa;
      max-width: 100%;
      box-sizing: border-box;
    }
    h2 {
      color: #4CAF50;
    }
    input, select, button {
      margin: 5px;
      padding: 6px;
      font-size: 14px;
    }
    label {
      font-weight: bold;
      margin-left: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    th {
      background: #eee;
    }
    .buy { background: #e0f7fa; }
    .sell { background: #ffebee; }
    .controls {
      margin-top: 15px;
    }
    .controls button {
      background-color: #ddd;
      border: 1px solid #aaa;
      cursor: pointer;
    }
    .summary {
      margin-top: 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h2>ğŸ“ ì‚¬íŒ”ì‚¬íŒ” ë‹¨íƒ€ ê³„ì‚°ê¸°</h2>

  

  

  <div style="margin: 20px 0; max-width: 1000px; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
  <div style="display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-end;">
    <div style="flex: 1; min-width: 200px;">
      <label for="initialQty">í˜„ì¬ ë³´ìœ ìˆ˜ëŸ‰</label>
      <input type="number" id="initialQty" placeholder="ë³´ìœ  ìˆ˜ëŸ‰" value="0" style="width: 100%;">
    </div>
    <div style="flex: 1; min-width: 200px;">
      <label for="initialAvg">í˜„ì¬ í‰ë‹¨ê°€</label>
      <input type="number" id="initialAvg" placeholder="í‰ë‹¨ê°€" value="0" style="width: 100%;">
    </div>
    <div style="flex: 1; min-width: 200px;">
      <label for="initialReturn">í˜„ì¬ ìˆ˜ìµë¥  (%)</label>
      <input type="number" id="initialReturn" placeholder="ì˜ˆ: 3.5" value="0" style="width: 100%;">
    </div>
    <div style="flex: 1; min-width: 200px;">
      <label for="userCash">í˜„ì¬ ì˜ˆìˆ˜ê¸ˆ</label>
      <input type="number" id="userCash" placeholder="ì˜ˆ: 1000000" value="10000000" style="width: 100%;">
    </div>
    <div style="flex: 1; min-width: 150px; display: flex; align-items: flex-end;">
      <button onclick="applyInitialHoldings()" style="width: 100%;">ë³´ìœ  ë‚´ì—­ ì ìš©</button>
    </div>
  </div>
</div>
    
  </div>
    
  </div>
  

  <div style="display: flex; flex-wrap: wrap; gap: 16px; margin-top: 20px; align-items: flex-end;">
  <div style="display: flex; flex-direction: column; min-width: 130px;">
    <label for="tradeType">ê±°ë˜ ìœ í˜•</label>
    <select id="tradeType">
      <option value="buy">ë§¤ìˆ˜</option>
      <option value="sell">ë§¤ë„</option>
    </select>
  </div>
  <div style="display: flex; flex-direction: column; min-width: 130px;">
    <label for="tradePrice">ë‹¨ê°€</label>
    <input type="number" id="tradePrice" placeholder="ë‹¨ê°€">
  </div>
  <div style="display: flex; flex-direction: column; min-width: 130px;">
    <label for="tradeQty">ìˆ˜ëŸ‰</label>
    <input type="number" id="tradeQty" placeholder="ìˆ˜ëŸ‰" value="5">
  </div>
  <div style="display: flex; flex-direction: column; min-width: 130px;">
    <label for="tradeFee">ìˆ˜ìˆ˜ë£Œìœ¨ (%)</label>
    <input type="number" id="tradeFee" placeholder="ì˜ˆ: 0.15" value="0">
  </div>
  <div style="display: flex; flex-direction: column;">
    <label style="visibility: hidden;">ê±°ë˜ ì¶”ê°€</label>
    <button onclick="addTrade()">ê±°ë˜ ì¶”ê°€</button>
  </div>
</div>
   

  <div class="summary" style="display: flex; justify-content: space-between; align-items: center;">
    <div>
    ğŸ’° ëˆ„ì  ì†ìµ: <span id="totalProfit">0</span>ì›
    | ğŸ“Š ëˆ„ì  ìˆ˜ìµë¥ : <span id="totalReturn">0.00</span>%<br>
    ğŸ“¦ ì´ ìˆ˜ëŸ‰: <span id="holdQty">0</span>ì£¼
    | ğŸ’µ í‰ë‹¨ê°€: <span id="avgPrice">0</span>ì›
    | ğŸ§¾ ì´ ë§¤ì…ê¸ˆ: <span id="totalBuy">0</span>ì›
    | ğŸ’¸ ì”ì—¬ ì˜ˆìˆ˜ê¸ˆ: <span id="cashRemaining">0</span>ì›
    | â± ì§„í–‰ë¥ : <span id="progressRate">0.00</span>%
      </div>
    <div>
      <button onclick="resetTable()">ì´ˆê¸°í™”</button>
      <button onclick="copyTable()">ë³µì‚¬</button>
      <button onclick="downloadCSV()">ì €ì¥</button>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>íšŒì°¨</th>
        <th>ì‹œê°„</th>
        <th>í¬ì§€ì…˜</th>
        <th>ë‹¨ê°€</th>
        <th>ìˆ˜ëŸ‰</th>
        <th>ì²´ê²°ê¸ˆì•¡</th>
        <th>í‰ë‹¨</th>
        <th>ì‹¤í˜„ ì†ìµ</th>
        <th>ëˆ„ì  ì†ìµ</th>
        <th>ìˆ˜í–‰</th>
      </tr>
    </thead>
    <tbody id="tradeTable"></tbody>
  </table>

  <script>
    let avgPrice = 0;
    let holdQty = 0;
    let totalProfit = 0;
    let count = 0;
    let totalBuyAmount = 0;
    let startingCapital = 10000000;

    function updateSummary() {
      document.getElementById('totalProfit').innerText = totalProfit.toLocaleString();
      const returnRate = totalBuyAmount > 0 ? (totalProfit / totalBuyAmount) * 100 : 0;
      document.getElementById('totalReturn').innerText = returnRate.toFixed(2);
      document.getElementById('holdQty').innerText = holdQty;
      document.getElementById('avgPrice').innerText = avgPrice.toFixed(2);
      document.getElementById('totalBuy').innerText = totalBuyAmount.toLocaleString();
      document.getElementById('cashRemaining').innerText = (startingCapital - totalBuyAmount + totalProfit).toLocaleString();
      const progress = (totalBuyAmount / startingCapital) * 100;
      document.getElementById('progressRate').innerText = progress.toFixed(2);
    }

    function addTrade() {
      const type = document.getElementById('tradeType').value;
      const price = parseFloat(document.getElementById('tradePrice').value);
      const qty = parseInt(document.getElementById('tradeQty').value);
      const now = new Date().toLocaleTimeString('ko-KR');

      if (!price || !qty) return alert('ê°€ê²©ê³¼ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');

      const row = document.createElement('tr');
      row.className = type === 'buy' ? 'buy' : 'sell';
      const feeRate = parseFloat(document.getElementById('tradeFee').value) || 0;
      const total = price * qty * (1 + feeRate / 100);
      let profit = '-';

      if (type === 'buy') {
        avgPrice = ((avgPrice * holdQty) + total) / (holdQty + qty);
        holdQty += qty;
        totalBuyAmount += total;
      } else {
        if (qty > holdQty) return alert('ë³´ìœ  ìˆ˜ëŸ‰ ì´ˆê³¼!');
        profit = ((price - avgPrice) * qty);
        totalProfit += profit;
        holdQty -= qty;
        if (holdQty === 0) {
          avgPrice = 0;
          totalBuyAmount = 0;
        }
      }

      count++;
      row.innerHTML = `
        <td>${count}</td>
        <td>${now}</td>
        <td>${type === 'buy' ? 'ë§¤ìˆ˜' : 'ë§¤ë„'}</td>
        <td>${price}</td>
        <td>${qty}</td>
        <td>${total.toLocaleString()}</td>
        <td>${type === 'buy' ? avgPrice.toFixed(2) : '-'}</td>
        <td>${profit === '-' ? '-' : profit.toLocaleString()}</td>
        <td>${totalProfit.toLocaleString()}</td>
        <td>${type === 'sell' ? 'SELL' : 'BUY'}</td>
      `;
      document.getElementById('tradeTable').appendChild(row);
      updateSummary();
    }

    function resetTable() {
      document.getElementById('tradeTable').innerHTML = '';
      avgPrice = 0;
      holdQty = 0;
      totalProfit = 0;
      totalBuyAmount = 0;
      count = 0;
      updateSummary();
    }

    function copyTable() {
      const table = document.querySelector("table");
      const range = document.createRange();
      range.selectNode(table);
      window.getSelection().removeAllRanges();
      window.getSelection().addRange(range);
      try {
        document.execCommand("copy");
        alert("í‘œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. Ctrl+Vë¡œ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.");
      } catch (err) {
        alert("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
      }
      window.getSelection().removeAllRanges();
    }

    function downloadCSV() {
      let csv = "íšŒì°¨,ì‹œê°„,í¬ì§€ì…˜,ë‹¨ê°€,ìˆ˜ëŸ‰,ì²´ê²°ê¸ˆì•¡,í‰ë‹¨,ì‹¤í˜„ ì†ìµ,ëˆ„ì  ì†ìµ,ìˆ˜í–‰\n";
      document.querySelectorAll("#tradeTable tr").forEach(row => {
        const cols = row.querySelectorAll("td");
        const rowData = Array.from(cols).map(td => td.innerText).join(",");
        csv += rowData + "\n";
      });

      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "sapal_trade_log.csv";
      a.click();
      URL.revokeObjectURL(url);
    }
  function applyInitialHoldings() {
      const qty = parseInt(document.getElementById('initialQty').value);
      const avg = parseFloat(document.getElementById('initialAvg').value);
      const returnRate = parseFloat(document.getElementById('initialReturn').value);
      const userCash = parseFloat(document.getElementById('userCash').value);

      if (isNaN(qty) || isNaN(avg) || isNaN(returnRate) || isNaN(userCash)) {
        alert('ë³´ìœ  ìˆ˜ëŸ‰, í‰ë‹¨ê°€, ìˆ˜ìµë¥ , ì˜ˆìˆ˜ê¸ˆì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      holdQty = qty;
      avgPrice = avg;
      totalBuyAmount = qty * avg;
      totalProfit = totalBuyAmount * (returnRate / 100);
      startingCapital = userCash + totalBuyAmount;
      updateSummary();
    }

  </script>
</body>
</html>
