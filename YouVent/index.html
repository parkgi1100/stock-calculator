<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìœ ë²¤íŠ¸ (YouVent) - ëª¨ë“  ìœ íŠœë¸Œ ì´ë²¤íŠ¸ë¥¼ í•œëˆˆì—!</title>
    <meta name="description" content="ìœ íŠœë¸Œ, SNS, ì‡¼í•‘ëª° ë“± ëª¨ë“  ì¢…ë¥˜ì˜ ì´ë²¤íŠ¸ë¥¼ ëª¨ì•„ì„œ ë³´ì—¬ì£¼ëŠ” ìœ ë²¤íŠ¸ì…ë‹ˆë‹¤.">
    <meta name="keywords" content="ìœ íŠœë¸Œ, ì´ë²¤íŠ¸, êµ¬ë…, ëŒ“ê¸€, ê²½í’ˆ, í• ì¸, ì—ì–´ë“œë">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; }
        .form-checkbox:checked { background-color: #2563eb; border-color: #2563eb; }
        .page, .modal-overlay { transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out; }
        .hidden { display: none; }
        .modal-overlay.hidden { visibility: hidden; opacity: 0; }
        .modal-overlay { visibility: visible; opacity: 1; }
        .pagination-btn.active { background-color: #2563eb; color: white; border-color: #2563eb; }
        .nav-link.active { color: #2563eb; font-weight: 700; border-bottom: 2px solid #2563eb; }
        .sub-filter-btn.active { background-color: #3B82F6; color: white; }
        .terms-content { height: 12rem; overflow-y: scroll; border: 1px solid #e5e7eb; padding: 0.75rem; font-size: 0.875rem; color: #4b5563; background-color: #f9fafb; border-radius: 0.5rem;}
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex flex-col min-h-screen">

    <!-- Header Section -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-blue-600 cursor-pointer" onclick="showListPage('ongoing', 'all')">You<span class="text-orange-500">Vent</span></div>
            <div id="main-nav" class="hidden md:flex items-center space-x-8">
                <a href="#" id="nav-ongoing" class="nav-link pb-1" onclick="showListPage('ongoing', 'all'); return false;">ì§„í–‰ì¤‘ì¸ ì´ë²¤íŠ¸</a>
                <a href="#" id="nav-ended" class="nav-link pb-1" onclick="showListPage('ended'); return false;">ì¢…ë£Œëœ ì´ë²¤íŠ¸</a>
                <a href="#" class="nav-link pb-1" onclick="openModal('report-modal')">ì´ë²¤íŠ¸ ì œë³´</a>
            </div>
            <div class="flex items-center">
                <div id="auth-section" class="hidden md:block mr-4">
                     <button onclick="openModal('login-modal')" class="bg-blue-600 text-white px-4 py-2 rounded-full text-sm font-semibold shadow hover:bg-blue-700">ë¡œê·¸ì¸</button>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-gray-500 focus:outline-none">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </div>
        </nav>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t">
            <!-- Mobile nav links will be populated by JS -->
        </div>
    </header>

    <div class="flex-grow">
        <main id="list-page" class="page container mx-auto px-6 py-8">
            <div id="ended-events-notice" class="hidden mb-4 p-4 bg-blue-100 text-blue-800 rounded-lg text-sm text-center">
                ì¢…ë£Œì¼ë¡œë¶€í„° 2ì£¼ê°€ ì§€ë‚œ ê²Œì‹œê¸€ì€ ìë™ìœ¼ë¡œ ëª©ë¡ì—ì„œ ì‚¬ë¼ì§‘ë‹ˆë‹¤.
            </div>
            <div id="sub-filter-container" class="mb-6 flex space-x-2 flex-wrap gap-y-2">
                <button id="sub-filter-all" class="sub-filter-btn px-4 py-2 rounded-full text-sm font-semibold border" onclick="setSubFilter('all')">ì „ì²´</button>
                <button id="sub-filter-youtube" class="sub-filter-btn px-4 py-2 rounded-full text-sm font-semibold border" onclick="setSubFilter('youtube')">ìœ íŠœë¸Œ ë° SNS</button>
                <button id="sub-filter-discount" class="sub-filter-btn px-4 py-2 rounded-full text-sm font-semibold border" onclick="setSubFilter('discount')">í• ì¸ì´ë²¤íŠ¸</button>
                <button id="sub-filter-airdrop" class="sub-filter-btn px-4 py-2 rounded-full text-sm font-semibold border" onclick="setSubFilter('airdrop')">ì—ì–´ë“œë</button>
                <button id="sub-filter-other" class="sub-filter-btn px-4 py-2 rounded-full text-sm font-semibold border" onclick="setSubFilter('other')">ê¸°íƒ€</button>
            </div>
            <div id="list-header" class="hidden md:flex bg-white rounded-t-lg px-6 py-3 text-sm font-bold text-gray-600 border-b items-center"></div>
            <div id="eventList" class="bg-white rounded-b-lg shadow-sm"></div>
            <div id="pagination" class="mt-6 flex justify-center items-center space-x-2"></div>
        </main>

        <main id="detail-page" class="page hidden container mx-auto px-6 py-8"></main>
        
        <main id="admin-dashboard-page" class="page hidden container mx-auto px-6 py-8">
            <h1 class="text-3xl font-bold mb-8">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-bold mb-4">ì´ë²¤íŠ¸ ê´€ë¦¬</h2>
                    <button onclick="openModal('register-modal')" class="w-full bg-green-500 text-white p-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">+ ìƒˆ ì´ë²¤íŠ¸ ë“±ë¡í•˜ê¸°</button>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-xl font-bold mb-4">ì ‘ìˆ˜ëœ ì œë³´ ëª©ë¡</h2>
                    <div id="reportList" class="space-y-3 max-h-96 overflow-y-auto"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="container mx-auto px-6 py-4 text-xs">
            <div class="flex flex-col md:flex-row justify-between items-center gap-2 text-center md:text-left">
                <p class="order-3 md:order-1">&copy; 2025 YouVent. All Rights Reserved.</p>
                <div class="order-2 md:order-2 flex space-x-4">
                    <a href="#" onclick="openModal('terms-of-service-modal'); return false;" class="hover:text-white">ì´ìš©ì•½ê´€</a>
                    <a href="#" onclick="openModal('privacy-policy-modal'); return false;" class="hover:text-white">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
                </div>
                <p class="order-1 md:order-3">ìš´ì˜ì ë¬¸ì˜: parkgi1100@gmail.com</p>
            </div>
        </div>
    </footer>

    <div id="login-modal" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"></div>
    <div id="report-modal" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"></div>
    <div id="register-modal" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"></div>
    <div id="terms-modal" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"></div>
    <div id="logout-options-modal" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"></div>
    <div id="delete-account-modal" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"></div>
    <div id="terms-of-service-modal" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"></div>
    <div id="privacy-policy-modal" class="modal-overlay hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"></div>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc, doc, updateDoc, query, where, orderBy, getDoc, setDoc, serverTimestamp, runTransaction, deleteDoc } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-firestore.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, deleteUser } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-auth.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyD5xVbWnUE4gF9PUdXoqUZ62U7YDwiSu0s",
            authDomain: "youvent-3cb0d.firebaseapp.com",
            projectId: "youvent-3cb0d",
            storageBucket: "youvent-3cb0d.appspot.com",
            messagingSenderId: "647513816009",
            appId: "1:647513816009:web:0638bbd49496e1514f4618",
            measurementId: "G-BKNFPCY4NS"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const eventsCollection = collection(db, "events");
        const usersCollection = collection(db, "users");
        const reportsCollection = collection(db, "reports");

        let currentUser = null;
        let currentUserInfo = null;
        let mainFilter = 'ongoing';
        let subFilter = 'all';
        
        const listPage = document.getElementById('list-page'), detailPage = document.getElementById('detail-page'), adminDashboardPage = document.getElementById('admin-dashboard-page');
        const eventList = document.getElementById('eventList'), paginationContainer = document.getElementById('pagination');
        const listHeader = document.getElementById('list-header'), subFilterContainer = document.getElementById('sub-filter-container');
        const endedEventsNotice = document.getElementById('ended-events-notice');
        const authSection = document.getElementById('auth-section');
        const mainNav = document.getElementById('main-nav');
        const reportList = document.getElementById('reportList');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');

        // --- ë¡œì§ í•¨ìˆ˜ ---
        const getEventStatus = (endDateStr) => {
            const today = new Date();
            if (!endDateStr) return { status: 'ì§„í–‰ì¤‘', badge: '<span class="bg-green-100 text-green-700 text-xs font-bold px-3 py-1 rounded-full">ì§„í–‰ì¤‘</span>', d_day_html: '' };
            const endDate = new Date(endDateStr + 'T23:59:59');
            const diffTime = endDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            if (diffDays >= 0) {
                return { status: 'ì§„í–‰ì¤‘', badge: '<span class="bg-green-100 text-green-700 text-xs font-bold px-3 py-1 rounded-full">ì§„í–‰ì¤‘</span>', d_day_html: `<span class="text-orange-500 font-bold text-lg">${`D-${diffDays}`}</span>` };
            } else {
                return { status: 'ì¢…ë£Œ', badge: '<span class="bg-gray-200 text-gray-600 text-xs font-bold px-3 py-1 rounded-full">ì¢…ë£Œ</span>', d_day_html: `<span class="text-gray-400 font-bold">ì¢…ë£Œ</span>` };
            }
        };

        const handleParticipation = async (eventId, newStatus) => {
            if (!currentUser) { alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤."); openModal('login-modal'); return; }
            const userId = currentUser.uid;
            const eventRef = doc(db, "events", eventId);
            const participationRef = doc(db, "events", eventId, "participants", userId);
            try {
                await runTransaction(db, async (transaction) => {
                    const eventDoc = await transaction.get(eventRef);
                    if (!eventDoc.exists()) throw "Event does not exist!";
                    
                    const participationDoc = await transaction.get(participationRef);
                    const oldStatus = participationDoc.exists() ? participationDoc.data().status : null;

                    let participatedCount = eventDoc.data().participatedCount || 0;
                    let notInterestedCount = eventDoc.data().notInterestedCount || 0;

                    if (oldStatus === newStatus) {
                        transaction.delete(participationRef);
                        if (newStatus === 'participated') participatedCount--;
                        if (newStatus === 'not_interested') notInterestedCount--;
                    } else {
                        if (oldStatus === 'participated') participatedCount--;
                        if (oldStatus === 'not_interested') notInterestedCount--;
                        
                        if (newStatus === 'participated') participatedCount++;
                        if (newStatus === 'not_interested') notInterestedCount++;
                        
                        transaction.set(participationRef, { status: newStatus, updatedAt: serverTimestamp() });
                    }
                    
                    transaction.update(eventRef, { 
                        participatedCount: participatedCount < 0 ? 0 : participatedCount,
                        notInterestedCount: notInterestedCount < 0 ? 0 : notInterestedCount
                    });
                });
                if (!detailPage.classList.contains('hidden')) { showDetailPage(eventId); } else { renderEventList(); }
            } catch (error) { console.error("ì°¸ì—¬ ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜: ", error); alert('ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); }
        };

        const handleEventSubmit = async (e) => {
            e.preventDefault();
            if (!currentUserInfo || !['admin', 'sub-admin'].includes(currentUserInfo.role)) {
                alert('ì´ë²¤íŠ¸ ë“±ë¡ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            const form = e.target;
            const eventType = form.eventType.value;
            const linkUrl = form.linkUrl.value;
            const description = form.description.value;
            
            try { new URL(linkUrl); } catch (_) { alert('ì˜¬ë°”ë¥¸ í˜•ì‹ì˜ ë§í¬ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: https://...)'); return; }

            const q = query(eventsCollection, where("linkUrl", "==", linkUrl));
            const querySnapshot = await getDocs(q);
            if (!querySnapshot.empty) { alert('ì´ë¯¸ ë“±ë¡ëœ ë§í¬ì˜ ì´ë²¤íŠ¸ì…ë‹ˆë‹¤.'); return; }
            const newEvent = { type: eventType, prize: form.prize.value, channelName: form.channelName.value, endDate: form.endDate.value || '9999-12-31', linkUrl: linkUrl, description: description, participatedCount: 0, notInterestedCount: 0, createdAt: serverTimestamp() };
            try { await addDoc(eventsCollection, newEvent); alert('ì´ë²¤íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.'); closeModal('register-modal'); form.reset(); showListPage(eventType); } catch (error) { console.error("ì´ë²¤íŠ¸ ë“±ë¡ ì˜¤ë¥˜: ", error); alert('ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'); }
        };

        const handleReportSubmit = async (e) => {
            e.preventDefault();
            const form = e.target;
            const newReport = {
                linkUrl: form.linkUrl.value,
                summary: form.summary.value,
                status: 'pending',
                createdAt: serverTimestamp(),
                reporter: currentUser ? currentUser.email : 'ë¹„íšŒì›'
            };
            try {
                await addDoc(reportsCollection, newReport);
                alert('ì œë³´ê°€ ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.');
                closeModal('report-modal');
                form.reset();
            } catch (error) {
                console.error("ì œë³´ ë“±ë¡ ì˜¤ë¥˜: ", error);
                alert("ì œë³´ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }
        };
        
        // --- UI ë Œë”ë§ í•¨ìˆ˜ ---
        
        const updateActiveNav = () => {
            document.getElementById('nav-ongoing').classList.toggle('active', mainFilter === 'ongoing');
            document.getElementById('nav-ended').classList.toggle('active', mainFilter === 'ended');
            subFilterContainer.classList.toggle('hidden', mainFilter !== 'ongoing');
            endedEventsNotice.classList.toggle('hidden', mainFilter !== 'ended');
            if (mainFilter === 'ongoing') {
                document.querySelectorAll('.sub-filter-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(`sub-filter-${subFilter}`).classList.add('active');
            }
        }

        const setListHeader = () => {
            const isAdmin = currentUserInfo && ['admin', 'sub-admin'].includes(currentUserInfo.role);
            const adminHeader = isAdmin ? `<div class="w-[10%]"></div>` : '';

            if (subFilter === 'discount' && mainFilter === 'ongoing') {
                listHeader.innerHTML = `<div class="w-1/5 text-center">ìƒíƒœ</div><div class="w-2/5">ìƒí’ˆ/ë‚´ìš©</div><div class="w-1/5">íŒë§¤ì²˜</div><div class="w-1/5 text-center">ë°”ë¡œê°€ê¸°</div>${adminHeader}`;
            } else {
                listHeader.innerHTML = `<div class="w-[10%] text-center">D-Day</div><div class="w-[10%] text-center">ìƒíƒœ</div><div class="w-[35%]">ìƒí’ˆ</div><div class="w-[20%]">ì±„ë„ëª…</div><div class="w-[10%]">ë§ˆê°ì¼</div><div class="w-[10%] text-center">ì°¸ì—¬ ì—¬ë¶€</div>${adminHeader}`;
            }
        }

        const renderEventList = async () => {
            eventList.innerHTML = `<div class="text-center p-10 text-gray-500">ì´ë²¤íŠ¸ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>`;
            setListHeader();
            try {
                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];
                let queryConstraints = [];
                if (mainFilter === 'ongoing') {
                    queryConstraints.push(where("endDate", ">=", todayStr));
                } else {
                    const twoWeeksAgo = new Date(new Date().setDate(today.getDate() - 14));
                    const twoWeeksAgoStr = twoWeeksAgo.toISOString().split('T')[0];
                    queryConstraints.push(where("endDate", "<", todayStr), where("endDate", ">=", twoWeeksAgoStr));
                }
                if (mainFilter === 'ongoing' && subFilter !== 'all') {
                    queryConstraints.push(where("type", "==", subFilter));
                }
                queryConstraints.push(orderBy("endDate", "desc"));
                const q = query(eventsCollection, ...queryConstraints);
                const querySnapshot = await getDocs(q);
                const eventsData = [];
                querySnapshot.forEach((doc) => { eventsData.push({ id: doc.id, ...doc.data() }); });
                eventList.innerHTML = '';
                if (eventsData.length === 0) {
                    eventList.innerHTML = `<div class="text-center p-10 text-gray-500">í‘œì‹œí•  ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
                } else {
                    const listItemsHtml = await Promise.all(eventsData.map(async (event) => {
                        const { badge, d_day_html } = getEventStatus(event.endDate);
                        const isAdmin = currentUserInfo && ['admin', 'sub-admin'].includes(currentUserInfo.role);
                        const deleteButton = isAdmin ? `<button onclick="deleteEvent('${event.id}', '${event.prize.replace(/'/g, "\\'")}')" class="text-red-500 hover:text-red-700 text-xs">ì‚­ì œ</button>` : '';

                        if (event.type === 'discount') {
                            return `<div class="border-b last:border-b-0"><div class="hidden md:flex w-full items-center px-6 py-4 hover:bg-gray-50"><div class="w-1/5 text-center">${badge}</div><div class="w-2/5 font-bold truncate">${event.prize}</div><div class="w-1/5 text-gray-600 truncate">${event.channelName}</div><div class="w-1/5 text-center"><a href="${event.linkUrl}" target="_blank" class="bg-blue-500 text-white px-4 py-2 rounded-md text-sm hover:bg-blue-600">ë³´ëŸ¬ê°€ê¸°</a></div><div class="w-[10%] text-center">${deleteButton}</div></div><a href="${event.linkUrl}" target="_blank" class="block md:hidden p-4"><div class="flex justify-between items-center mb-2"><p class="font-bold w-4/5">${event.prize}</p>${badge}</div><p class="text-sm text-gray-600">${event.channelName}</p></a></div>`;
                        } else {
                            let hasInteracted = false;
                            if (currentUser) {
                                const participationRef = doc(db, "events", event.id, "participants", currentUser.uid);
                                const participationSnap = await getDoc(participationRef);
                                hasInteracted = participationSnap.exists();
                            }
                            const participationCheckbox = `<input type="checkbox" onclick="handleParticipation('${event.id}', 'participated')" class="form-checkbox h-5 w-5 text-blue-600 rounded border-gray-300 cursor-pointer" ${hasInteracted ? 'checked' : ''}>`;
                            return `<div class="border-b last:border-b-0">
                                        <div class="hidden md:flex w-full items-center px-6 py-4 hover:bg-gray-50">
                                            <div class="w-[10%] text-center">${d_day_html}</div><div class="w-[10%] text-center">${badge}</div>
                                            <div class="w-[35%] pr-4"><p class="font-bold truncate cursor-pointer" onclick="showDetailPage('${event.id}')">${event.prize}</p></div>
                                            <div class="w-[20%] truncate">${event.channelName}</div><div class="w-[10%]">${event.endDate.replace(/-/g, '.')}</div>
                                            <div class="w-[10%] text-center">${currentUser ? participationCheckbox : ''}</div><div class="w-[5%] text-center">${deleteButton}</div>
                                        </div>
                                        <div class="md:hidden flex items-center p-3 space-x-3 border-b last:border-b-0">
                                            <div class="flex-shrink-0">
                                                ${currentUser ? participationCheckbox : '<div class="w-5 h-5"></div>'}
                                            </div>
                                            <div class="flex-grow min-w-0 cursor-pointer" onclick="showDetailPage('${event.id}')">
                                                <p class="font-semibold truncate">${event.prize}</p>
                                                <p class="text-xs text-gray-500 truncate">${event.channelName}</p>
                                            </div>
                                            <div class="flex-shrink-0 text-right text-sm w-16">
                                                ${d_day_html || badge}
                                            </div>
                                            ${isAdmin ? `<div class="flex-shrink-0 ml-2">${deleteButton}</div>` : ''}
                                        </div>
                                    </div>`;
                        }
                    }));
                    eventList.innerHTML = listItemsHtml.join('');
                }
                paginationContainer.innerHTML = '';
            } catch (error) {
                console.error("ì´ë²¤íŠ¸ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜: ", error);
                eventList.innerHTML = `<div class="text-center p-10 text-red-500">ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br>ì˜¤ë¥˜ í•´ê²°ì„ ìœ„í•´ ì½”ë“œ ìƒë‹¨ì˜ [ì˜¤ë¥˜ í•´ê²°] ì•ˆë‚´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</div>`;
            }
        }
        
        // --- í˜ì´ì§€ ì „í™˜ í•¨ìˆ˜ ---
        const showPage = (pageId) => {
            [listPage, detailPage, adminDashboardPage].forEach(p => p.classList.add('hidden'));
            document.getElementById(pageId).classList.remove('hidden');
            window.scrollTo(0, 0);
        }

        const showListPage = (newMainFilter, newSubFilter = 'all') => {
            mainFilter = newMainFilter;
            subFilter = newSubFilter;
            updateActiveNav();
            showPage('list-page');
            renderEventList();
        }
        
        const setSubFilter = (newSubFilter) => {
            subFilter = newSubFilter;
            updateActiveNav();
            renderEventList();
        }
        
        // --- ì¸ì¦ ë° ì‚¬ìš©ì ì •ë³´ ì²˜ë¦¬ ---
        const handleUser = async (user) => {
            if (user) {
                const userRef = doc(db, "users", user.uid);
                const userSnap = await getDoc(userRef);
                currentUserInfo = userSnap.exists() ? userSnap.data() : null;
                if (!currentUserInfo) { 
                    openModal('terms-modal');
                } else if (!currentUserInfo.termsAgreed) {
                    openModal('terms-modal');
                }
            } else {
                currentUserInfo = null;
            }
            updateUIForAuthState(user);
        }
        
        const agreeAndSignUp = async () => {
            closeModal('terms-modal');
            const provider = new GoogleAuthProvider();
            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                const userRef = doc(db, "users", user.uid);
                const newUserInfo = { email: user.email, displayName: user.displayName, photoURL: user.photoURL, role: "user", createdAt: serverTimestamp(), termsAgreed: true };
                await setDoc(userRef, newUserInfo);
                currentUserInfo = newUserInfo;
                alert("íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. í™˜ì˜í•©ë‹ˆë‹¤!");
            } catch (error) { console.error("íšŒì›ê°€ì…/ë¡œê·¸ì¸ ì˜¤ë¥˜:", error); alert("ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); }
        }

        const updateUIForAuthState = (user) => {
            currentUser = parkgi1100@gmail.com;
            const isAdmin = currentUserInfo && currentUserInfo.role === 'admin';
            const isSubAdmin = currentUserInfo && currentUserInfo.role === 'sub-admin';

            if (user) { 
                authSection.innerHTML = `<button onclick="openModal('logout-options-modal')" class="font-semibold text-gray-700 hover:text-blue-600 hidden md:block">${user.displayName} ë‹˜</button>`; 
            } else { 
                authSection.innerHTML = `<button onclick="openModal('login-modal')" class="bg-blue-600 text-white px-4 py-2 rounded-full text-sm font-semibold shadow hover:bg-blue-700 hidden md:block">ë¡œê·¸ì¸</button>`; 
            }
            
            const adminNavLink = document.getElementById('admin-nav-link');
            if ((isAdmin || isSubAdmin) && !adminNavLink) { 
                const link = document.createElement('a'); link.id = 'admin-nav-link'; link.href = '#'; 
                link.className = 'nav-link pb-1 text-red-500 font-bold'; link.innerText = 'ê´€ë¦¬ì'; 
                link.onclick = () => showAdminDashboard(); mainNav.appendChild(link); 
            } else if (!isAdmin && !isSubAdmin && adminNavLink) { 
                adminNavLink.remove(); 
            }
            
            // Mobile Menu
            const mobileNavContainer = document.getElementById('mobile-menu');
            let mobileNavHTML = `
                <a href="#" class="block py-2 px-4 text-sm hover:bg-gray-100" onclick="showListPage('ongoing', 'all'); return false;">ì§„í–‰ì¤‘ì¸ ì´ë²¤íŠ¸</a>
                <a href="#" class="block py-2 px-4 text-sm hover:bg-gray-100" onclick="showListPage('ended'); return false;">ì¢…ë£Œëœ ì´ë²¤íŠ¸</a>
                <a href="#" class="block py-2 px-4 text-sm hover:bg-gray-100" onclick="openModal('report-modal')">ì´ë²¤íŠ¸ ì œë³´</a>
            `;
            if (isAdmin || isSubAdmin) {
                mobileNavHTML += `<a href="#" class="block py-2 px-4 text-sm text-red-500 font-bold hover:bg-gray-100" onclick="showAdminDashboard()">ê´€ë¦¬ì</a>`;
            }
            mobileNavHTML += '<hr class="my-2">';
            if(user) {
                mobileNavHTML += `<a href="#" class="block py-2 px-4 text-sm hover:bg-gray-100" onclick="openModal('logout-options-modal')">${user.displayName}ë‹˜ (ê³„ì •ê´€ë¦¬)</a>`;
            } else {
                mobileNavHTML += `<a href="#" class="block py-2 px-4 text-sm hover:bg-gray-100" onclick="openModal('login-modal')">ë¡œê·¸ì¸ / íšŒì›ê°€ì…</a>`;
            }
            mobileNavContainer.innerHTML = mobileNavHTML;

        };

        const login = async () => { 
            const provider = new GoogleAuthProvider(); 
            try { 
                await signInWithPopup(auth, provider); 
                closeModal('login-modal'); 
            } 
            catch (error) { console.error("Google ë¡œê·¸ì¸ ì˜¤ë¥˜:", error); alert("ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); } 
        };

        const logout = async () => { 
            try { await signOut(auth); closeModal('logout-options-modal');} 
            catch (error) { console.error("ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:", error); } 
        };
        
        const deleteAccount = async () => {
            if (!currentUser) return;
            try {
                const userRef = doc(db, "users", currentUser.uid);
                await deleteDoc(userRef);
                await deleteUser(currentUser);
                closeModal('delete-account-modal');
                alert("íšŒì›íƒˆí‡´ê°€ ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ìš©í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.");
            } catch (error) {
                console.error("íšŒì›íƒˆí‡´ ì˜¤ë¥˜: ", error);
                alert("íšŒì›íƒˆí‡´ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì¬ë¡œê·¸ì¸ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            }
        };

        const showDetailPage = async (id) => {
            if (!currentUser) {
                alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.");
                openModal('login-modal');
                return;
            }
            const eventDocRef = doc(db, "events", id);
            try {
                const docSnap = await getDoc(eventDocRef);
                if (!docSnap.exists()) { detailPage.innerHTML = `<div class="text-center p-10 text-red-500">í•´ë‹¹ ì´ë²¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>`; showPage('detail-page'); return; }
                const event = { id: docSnap.id, ...docSnap.data() };
                const { badge, d_day_html } = getEventStatus(event.endDate);
                let participationStatus = null;
                if (currentUser && (event.type === 'youtube' || event.type === 'airdrop' || event.type === 'other')) { 
                    const participationRef = doc(db, "events", event.id, "participants", currentUser.uid); 
                    const participationSnap = await getDoc(participationRef); 
                    if(participationSnap.exists()) {
                        participationStatus = participationSnap.data().status;
                    }
                }
                let detailHTML = `<div class="bg-white p-8 rounded-lg shadow-lg">
                    <div class="flex justify-between items-start mb-4">
                        <h1 class="text-3xl font-bold text-gray-900 mb-2 md:mb-0">${event.prize}</h1>
                        <div class="flex items-center space-x-3">${badge} ${d_day_html}</div>
                    </div>
                    <p class="text-lg text-gray-600 mb-6">ì±„ë„ëª…: ${event.channelName}</p>
                    <div class="border-y py-6 mb-6">
                        <h2 class="text-xl font-semibold mb-3">ìƒì„¸ ì •ë³´</h2>
                        <p class="mb-4 whitespace-pre-wrap">${event.description || 'ìƒì„¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.'}</p>
                        <a href="${event.linkUrl}" target="_blank" class="inline-block bg-red-600 text-white px-5 py-2 rounded-lg font-semibold hover:bg-red-700">ë§í¬ ë°”ë¡œê°€ê¸° &rarr;</a>
                    </div>`;
                if (event.type === 'youtube' || event.type === 'airdrop' || event.type === 'other') { 
                    const participatedBtnClass = participationStatus === 'participated' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-800';
                    const notInterestedBtnClass = participationStatus === 'not_interested' ? 'bg-gray-500 text-white' : 'bg-gray-200 text-gray-800';
                    detailHTML += `<div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                        <div class="flex items-center space-x-3">
                            <button onclick="handleParticipation('${event.id}', 'participated')" class="font-semibold px-4 py-2 rounded-lg ${participatedBtnClass}">ğŸ‘ ì°¸ì—¬í•˜ê¸° (${event.participatedCount || 0})</button>
                            <button onclick="handleParticipation('${event.id}', 'not_interested')" class="font-semibold px-4 py-2 rounded-lg ${notInterestedBtnClass}">ğŸ‘ ê´€ì‹¬ì—†ìŒ (${event.notInterestedCount || 0})</button>
                        </div>
                        <div class="flex items-center space-x-3">
                            <button onclick="showListPage('${mainFilter}', '${subFilter}')" class="font-semibold px-6 py-3 rounded-lg bg-gray-600 text-white hover:bg-gray-700">&larr; ëª©ë¡ìœ¼ë¡œ</button>
                        </div>
                    </div>`; 
                }
                detailHTML += `</div>`;
                detailPage.innerHTML = detailHTML;
                showPage('detail-page');
            } catch (error) { console.error("ìƒì„¸ í˜ì´ì§€ ë¡œë”© ì˜¤ë¥˜: ", error); detailPage.innerHTML = `<div class="text-center p-10 text-red-500">ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>`; }
        };

        const openModal = (modalId, data = {}) => { 
            const modal = document.getElementById(modalId); 
            if (modalId === 'register-modal' && data.linkUrl) { 
                const form = modal.querySelector('form'); 
                if (form) {
                    form.linkUrl.value = data.linkUrl;
                    form.description.value = data.summary || '';
                }
            } 
            modal.classList.remove('hidden'); 
        };

        const closeModal = (modalId) => { 
            document.getElementById(modalId).classList.add('hidden'); 
        };

        const renderModals = () => { 
            document.getElementById('login-modal').innerHTML = `<div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-sm"><h2 class="text-2xl font-bold text-center mb-6">ë¡œê·¸ì¸ ë˜ëŠ” íšŒì›ê°€ì…</h2><div class="space-y-4"><button onclick="login()" class="w-full flex items-center justify-center bg-white border border-gray-300 py-3 rounded-lg hover:bg-gray-200 font-semibold">Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</button><div class="text-center text-sm text-gray-500">ë˜ëŠ”</div><button onclick="openModal('terms-modal'); closeModal('login-modal');" class="w-full flex items-center justify-center bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-semibold">íšŒì›ê°€ì…</button></div><button onclick="closeModal('login-modal')" class="mt-6 w-full text-center text-gray-500">ë‹«ê¸°</button></div>`; 
            document.getElementById('report-modal').innerHTML = `<div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md"><h2 class="text-2xl font-bold mb-6">ì´ë²¤íŠ¸ ì œë³´í•˜ê¸°</h2><form onsubmit="handleReportSubmit(event)"><div class="space-y-4"><input name="linkUrl" type="url" placeholder="ì´ë²¤íŠ¸ ë§í¬" required class="w-full p-3 border rounded-lg"><textarea name="summary" placeholder="ì´ë²¤íŠ¸ ë‚´ìš© ìš”ì•½" required class="w-full p-3 border rounded-lg h-24"></textarea></div><div class="mt-6 flex justify-end space-x-3"><button type="button" onclick="closeModal('report-modal')" class="px-6 py-2 bg-gray-200 rounded-lg">ì·¨ì†Œ</button><button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg">ì œì¶œ</button></div></form></div>`; 
            document.getElementById('register-modal').innerHTML = `<div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md"><h2 class="text-2xl font-bold mb-6">ìƒˆ ì´ë²¤íŠ¸ ë“±ë¡</h2><form onsubmit="handleEventSubmit(event)"><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700">ì´ë²¤íŠ¸ ì¢…ë¥˜</label><select name="eventType" class="w-full p-3 border rounded-lg"><option value="youtube">ìœ íŠœë¸Œ(SNS)</option><option value="discount">í• ì¸ì´ë²¤íŠ¸</option><option value="airdrop">ì—ì–´ë“œë</option><option value="other">ê¸°íƒ€</option></select></div><input type="text" name="prize" placeholder="ìƒí’ˆëª…/ë‚´ìš©" required class="w-full p-3 border rounded-lg"><input type="text" name="channelName" placeholder="ì±„ë„ëª…/íŒë§¤ì²˜" required class="w-full p-3 border rounded-lg"><input type="url" name="linkUrl" placeholder="ì´ë²¤íŠ¸ ë§í¬ (https://...)" required class="w-full p-3 border rounded-lg"><input type="date" name="endDate" class="w-full p-3 border rounded-lg"><textarea name="description" placeholder="ìƒì„¸ ë‚´ìš© (ì°¸ì—¬ ë°©ë²• ë“±)" required class="w-full p-3 border rounded-lg h-24"></textarea></div><div class="mt-6 flex justify-end space-x-3"><button type="button" onclick="closeModal('register-modal')" class="px-6 py-2 bg-gray-200 rounded-lg">ì·¨ì†Œ</button><button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg">ë“±ë¡</button></div></form></div>`; 
            document.getElementById('terms-modal').innerHTML = `<div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md"><h2 class="text-2xl font-bold mb-4">YouVent ì„œë¹„ìŠ¤ ì•½ê´€ ë™ì˜</h2><p class="text-gray-600 mb-6">ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì‹œë ¤ë©´ ì•„ë˜ì˜ ì´ìš©ì•½ê´€ê³¼ ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì— ë™ì˜í•´ì£¼ì„¸ìš”.</p><div class="space-y-4"><div class="space-y-2"> <h3 class="font-semibold">ì´ìš©ì•½ê´€</h3> <div class="terms-content"><strong>ì œ1ì¡° (ëª©ì )</strong><br>ë³¸ ì•½ê´€ì€ YouVent(ì´í•˜ 'íšŒì‚¬')ê°€ ì œê³µí•˜ëŠ” ëª¨ë“  ì„œë¹„ìŠ¤(ì´í•˜ 'ì„œë¹„ìŠ¤')ì˜ ì´ìš© ì¡°ê±´ ë° ì ˆì°¨, íšŒì›ê³¼ íšŒì‚¬ì˜ ê¶Œë¦¬, ì˜ë¬´ ë° ì±…ì„ì‚¬í•­ ë“± ê¸°íƒ€ í•„ìš”í•œ ì‚¬í•­ì„ ê·œì •í•¨ì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.<br><br><strong>ì œ2ì¡° (ìš©ì–´ì˜ ì •ì˜)</strong><br>ë³¸ ì•½ê´€ì—ì„œ ì‚¬ìš©í•˜ëŠ” ìš©ì–´ì˜ ì •ì˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.<br>1. 'ì„œë¹„ìŠ¤'ë¼ í•¨ì€ íšŒì‚¬ê°€ ì œê³µí•˜ëŠ” ëª¨ë“  ì´ë²¤íŠ¸ ì •ë³´ ì œê³µ ì„œë¹„ìŠ¤ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.<br>2. 'íšŒì›'ì´ë¼ í•¨ì€ íšŒì‚¬ì— ê°œì¸ì •ë³´ë¥¼ ì œê³µí•˜ì—¬ íšŒì›ë“±ë¡ì„ í•œ ìë¡œì„œ, íšŒì‚¬ì˜ ì •ë³´ë¥¼ ì§€ì†ì ìœ¼ë¡œ ì œê³µë°›ìœ¼ë©°, íšŒì‚¬ê°€ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ê³„ì†ì ìœ¼ë¡œ ì´ìš©í•  ìˆ˜ ìˆëŠ” ìë¥¼ ë§í•©ë‹ˆë‹¤.<br><br><strong>ì œ3ì¡° (ì•½ê´€ì˜ íš¨ë ¥ ë° ë³€ê²½)</strong><br>1. ë³¸ ì•½ê´€ì€ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ê³ ì í•˜ëŠ” ëª¨ë“  íšŒì›ì— ëŒ€í•˜ì—¬ ê·¸ íš¨ë ¥ì„ ë°œìƒí•©ë‹ˆë‹¤.<br>2. íšŒì‚¬ëŠ” í•„ìš”í•œ ê²½ìš° ê´€ë ¨ ë²•ë ¹ì„ ìœ„ë°°í•˜ì§€ ì•ŠëŠ” ë²”ìœ„ì—ì„œ ë³¸ ì•½ê´€ì„ ê°œì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div><label class="flex items-center"><input type="checkbox" id="terms-agree-1" class="form-checkbox h-5 w-5"> <span class="ml-2 text-sm">ì´ìš©ì•½ê´€ì— ë™ì˜í•©ë‹ˆë‹¤. (í•„ìˆ˜)</span></label></div><div class="space-y-2"> <h3 class="font-semibold">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</h3> <div class="terms-content"><strong>1. ìˆ˜ì§‘í•˜ëŠ” ê°œì¸ì •ë³´ì˜ í•­ëª©</strong><br>íšŒì‚¬ëŠ” íšŒì›ê°€ì…, ì›í™œí•œ ê³ ê°ìƒë‹´, ê°ì¢… ì„œë¹„ìŠ¤ì˜ ì œê³µì„ ìœ„í•´ ìµœì´ˆ íšŒì›ê°€ì… ë‹¹ì‹œ ì•„ë˜ì™€ ê°™ì€ ìµœì†Œí•œì˜ ê°œì¸ì •ë³´ë¥¼ í•„ìˆ˜í•­ëª©ìœ¼ë¡œ ìˆ˜ì§‘í•˜ê³  ìˆìŠµë‹ˆë‹¤.<br>- êµ¬ê¸€ ê³„ì • ì •ë³´: ì´ë©”ì¼ ì£¼ì†Œ, ì´ë¦„, í”„ë¡œí•„ ì‚¬ì§„<br><br><strong>2. ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ë° ì´ìš© ëª©ì </strong><br>íšŒì‚¬ëŠ” ìˆ˜ì§‘í•œ ê°œì¸ì •ë³´ë¥¼ ë‹¤ìŒì˜ ëª©ì ì„ ìœ„í•´ í™œìš©í•©ë‹ˆë‹¤.<br>- íšŒì› ê´€ë¦¬: íšŒì›ì œ ì„œë¹„ìŠ¤ ì´ìš©ì— ë”°ë¥¸ ë³¸ì¸í™•ì¸, ê°œì¸ ì‹ë³„, ë¶ˆëŸ‰íšŒì›ì˜ ë¶€ì • ì´ìš© ë°©ì§€ì™€ ë¹„ì¸ê°€ ì‚¬ìš© ë°©ì§€<br><br><strong>3. ê°œì¸ì •ë³´ì˜ ë³´ìœ  ë° ì´ìš©ê¸°ê°„</strong><br>íšŒì›ì˜ ê°œì¸ì •ë³´ëŠ” ì›ì¹™ì ìœ¼ë¡œ ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ë° ì´ìš©ëª©ì ì´ ë‹¬ì„±ë˜ë©´ ì§€ì²´ ì—†ì´ íŒŒê¸°í•©ë‹ˆë‹¤. ë‹¨, íšŒì›íƒˆí‡´ ì‹œ ëª¨ë“  ì •ë³´ëŠ” ì¦‰ì‹œ ì‚­ì œë©ë‹ˆë‹¤.</div><label class="flex items-center"><input type="checkbox" id="terms-agree-2" class="form-checkbox h-5 w-5"> <span class="ml-2 text-sm">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì— ë™ì˜í•©ë‹ˆë‹¤. (í•„ìˆ˜)</span></label></div></div><div class="mt-6 flex justify-end"><button id="agree-btn" onclick="agreeAndSignUp()" class="px-6 py-2 bg-blue-600 text-white rounded-lg disabled:bg-gray-400" disabled>ì „ì²´ ë™ì˜í•˜ê³  íšŒì›ê°€ì…</button></div></div>`;
            document.getElementById('logout-options-modal').innerHTML = `<div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-xs"><h2 class="text-xl font-bold text-center mb-6">ê³„ì • ê´€ë¦¬</h2><div class="space-y-3"><button onclick="logout()" class="w-full bg-gray-200 text-gray-800 py-3 rounded-lg hover:bg-gray-300">ë¡œê·¸ì•„ì›ƒ</button><button onclick="closeModal('logout-options-modal'); openModal('delete-account-modal');" class="w-full text-red-600 py-2 hover:underline">íšŒì›íƒˆí‡´</button></div><button onclick="closeModal('logout-options-modal')" class="mt-4 w-full text-center text-gray-500 text-sm">ë‹«ê¸°</button></div>`;
            document.getElementById('delete-account-modal').innerHTML = `<div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md"><h2 class="text-2xl font-bold text-center mb-4">íšŒì› íƒˆí‡´</h2><p class="text-center text-gray-600 mb-6">ì •ë§ë¡œ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>ëª¨ë“  í™œë™ ê¸°ë¡ì´ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë˜ë©° ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p><div class="flex justify-center space-x-4"><button onclick="closeModal('delete-account-modal')" class="px-6 py-2 bg-gray-200 rounded-lg">ì·¨ì†Œ</button><button onclick="deleteAccount()" class="px-6 py-2 bg-red-600 text-white rounded-lg">íƒˆí‡´í•˜ê¸°</button></div></div>`;
            document.getElementById('terms-of-service-modal').innerHTML = `<div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-2xl"><h2 class="text-2xl font-bold mb-4">ì´ìš©ì•½ê´€</h2><div class="terms-content max-h-96"><strong>ì œ1ì¡° (ëª©ì )</strong><br>ë³¸ ì•½ê´€ì€ YouVent(ì´í•˜ 'íšŒì‚¬')ê°€ ì œê³µí•˜ëŠ” ëª¨ë“  ì„œë¹„ìŠ¤(ì´í•˜ 'ì„œë¹„ìŠ¤')ì˜ ì´ìš© ì¡°ê±´ ë° ì ˆì°¨, íšŒì›ê³¼ íšŒì‚¬ì˜ ê¶Œë¦¬, ì˜ë¬´ ë° ì±…ì„ì‚¬í•­ ë“± ê¸°íƒ€ í•„ìš”í•œ ì‚¬í•­ì„ ê·œì •í•¨ì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.<br><br><strong>ì œ2ì¡° (ìš©ì–´ì˜ ì •ì˜)</strong><br>ë³¸ ì•½ê´€ì—ì„œ ì‚¬ìš©í•˜ëŠ” ìš©ì–´ì˜ ì •ì˜ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.<br>1. 'ì„œë¹„ìŠ¤'ë¼ í•¨ì€ íšŒì‚¬ê°€ ì œê³µí•˜ëŠ” ëª¨ë“  ì´ë²¤íŠ¸ ì •ë³´ ì œê³µ ì„œë¹„ìŠ¤ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.<br>2. 'íšŒì›'ì´ë¼ í•¨ì€ íšŒì‚¬ì— ê°œì¸ì •ë³´ë¥¼ ì œê³µí•˜ì—¬ íšŒì›ë“±ë¡ì„ í•œ ìë¡œì„œ, íšŒì‚¬ì˜ ì •ë³´ë¥¼ ì§€ì†ì ìœ¼ë¡œ ì œê³µë°›ìœ¼ë©°, íšŒì‚¬ê°€ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ê³„ì†ì ìœ¼ë¡œ ì´ìš©í•  ìˆ˜ ìˆëŠ” ìë¥¼ ë§í•©ë‹ˆë‹¤.<br><br><strong>ì œ3ì¡° (ì•½ê´€ì˜ íš¨ë ¥ ë° ë³€ê²½)</strong><br>1. ë³¸ ì•½ê´€ì€ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ê³ ì í•˜ëŠ” ëª¨ë“  íšŒì›ì— ëŒ€í•˜ì—¬ ê·¸ íš¨ë ¥ì„ ë°œìƒí•©ë‹ˆë‹¤.<br>2. íšŒì‚¬ëŠ” í•„ìš”í•œ ê²½ìš° ê´€ë ¨ ë²•ë ¹ì„ ìœ„ë°°í•˜ì§€ ì•ŠëŠ” ë²”ìœ„ì—ì„œ ë³¸ ì•½ê´€ì„ ê°œì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div><div class="mt-6 flex justify-end"><button onclick="closeModal('terms-of-service-modal')" class="px-6 py-2 bg-gray-200 rounded-lg">ë‹«ê¸°</button></div></div>`;
            document.getElementById('privacy-policy-modal').innerHTML = `<div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-2xl"><h2 class="text-2xl font-bold mb-4">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</h2><div class="terms-content max-h-96"><strong>1. ìˆ˜ì§‘í•˜ëŠ” ê°œì¸ì •ë³´ì˜ í•­ëª©</strong><br>íšŒì‚¬ëŠ” íšŒì›ê°€ì…, ì›í™œí•œ ê³ ê°ìƒë‹´, ê°ì¢… ì„œë¹„ìŠ¤ì˜ ì œê³µì„ ìœ„í•´ ìµœì´ˆ íšŒì›ê°€ì… ë‹¹ì‹œ ì•„ë˜ì™€ ê°™ì€ ìµœì†Œí•œì˜ ê°œì¸ì •ë³´ë¥¼ í•„ìˆ˜í•­ëª©ìœ¼ë¡œ ìˆ˜ì§‘í•˜ê³  ìˆìŠµë‹ˆë‹¤.<br>- êµ¬ê¸€ ê³„ì • ì •ë³´: ì´ë©”ì¼ ì£¼ì†Œ, ì´ë¦„, í”„ë¡œí•„ ì‚¬ì§„<br><br><strong>2. ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ë° ì´ìš© ëª©ì </strong><br>íšŒì‚¬ëŠ” ìˆ˜ì§‘í•œ ê°œì¸ì •ë³´ë¥¼ ë‹¤ìŒì˜ ëª©ì ì„ ìœ„í•´ í™œìš©í•©ë‹ˆë‹¤.<br>- íšŒì› ê´€ë¦¬: íšŒì›ì œ ì„œë¹„ìŠ¤ ì´ìš©ì— ë”°ë¥¸ ë³¸ì¸í™•ì¸, ê°œì¸ ì‹ë³„, ë¶ˆëŸ‰íšŒì›ì˜ ë¶€ì • ì´ìš© ë°©ì§€ì™€ ë¹„ì¸ê°€ ì‚¬ìš© ë°©ì§€<br><br><strong>3. ê°œì¸ì •ë³´ì˜ ë³´ìœ  ë° ì´ìš©ê¸°ê°„</strong><br>íšŒì›ì˜ ê°œì¸ì •ë³´ëŠ” ì›ì¹™ì ìœ¼ë¡œ ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ë° ì´ìš©ëª©ì ì´ ë‹¬ì„±ë˜ë©´ ì§€ì²´ ì—†ì´ íŒŒê¸°í•©ë‹ˆë‹¤. ë‹¨, íšŒì›íƒˆí‡´ ì‹œ ëª¨ë“  ì •ë³´ëŠ” ì¦‰ì‹œ ì‚­ì œë©ë‹ˆë‹¤.</div><div class="mt-6 flex justify-end"><button onclick="closeModal('privacy-policy-modal')" class="px-6 py-2 bg-gray-200 rounded-lg">ë‹«ê¸°</button></div></div>`;

            const agreeBtn = document.getElementById('agree-btn');
            const chk1 = document.getElementById('terms-agree-1');
            const chk2 = document.getElementById('terms-agree-2');
            [chk1, chk2].forEach(chk => { chk.addEventListener('change', () => { agreeBtn.disabled = !(chk1.checked && chk2.checked); }); });
        };
        
        const showAdminDashboard = async () => {
            if (!currentUserInfo || !['admin', 'sub-admin'].includes(currentUserInfo.role)) {
                alert('ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            showPage('admin-dashboard-page');
            renderReportList();
        };

        const renderReportList = async () => {
            const reportListDiv = document.getElementById('reportList');
            reportListDiv.innerHTML = 'ì œë³´ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
            try {
                const q = query(reportsCollection, where("status", "==", "pending"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);
                if (querySnapshot.empty) {
                    reportListDiv.innerHTML = '<p class="text-gray-500">ìƒˆë¡œìš´ ì œë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }
                let reportsHtml = '<div class="divide-y divide-gray-200">';
                querySnapshot.forEach(doc => {
                    const report = doc.data();
                    reportsHtml += `
                        <div class="py-3">
                            <p class="font-semibold text-gray-800">${report.summary}</p>
                            <a href="${report.linkUrl}" target="_blank" class="text-sm text-blue-500 hover:underline">${report.linkUrl}</a>
                            <div class="mt-2 flex space-x-2">
                                <button onclick="approveReport('${doc.id}', '${report.linkUrl}', '${report.summary}')" class="bg-blue-500 text-white px-3 py-1 text-sm rounded-md hover:bg-blue-600">ìŠ¹ì¸</button>
                                <button onclick="rejectReport('${doc.id}')" class="bg-red-500 text-white px-3 py-1 text-sm rounded-md hover:bg-red-600">ê±°ì ˆ</button>
                            </div>
                        </div>
                    `;
                });
                reportsHtml += '</div>';
                reportListDiv.innerHTML = reportsHtml;
            } catch (error) {
                console.error("ì œë³´ ëª©ë¡ ë¡œë”© ì˜¤ë¥˜: ", error);
                reportListDiv.innerHTML = '<p class="text-red-500">ì œë³´ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. Firebase ë³´ì•ˆ ê·œì¹™ê³¼ ìƒ‰ì¸ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>';
            }
        };

        const approveReport = async (reportId, linkUrl, summary) => {
            openModal('register-modal', { linkUrl, summary });
            await updateDoc(doc(db, "reports", reportId), { status: "approved" });
        };

        const rejectReport = async (reportId) => {
            if (confirm("ì´ ì œë³´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                await deleteDoc(doc(db, "reports", reportId));
                renderReportList();
            }
        };

        const deleteEvent = async (eventId, eventPrize) => {
             if (!currentUserInfo || !['admin', 'sub-admin'].includes(currentUserInfo.role)) {
                alert('ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            if (confirm(`ì •ë§ë¡œ '${eventPrize}' ì´ë²¤íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                try {
                    await deleteDoc(doc(db, "events", eventId));
                    alert('ì´ë²¤íŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    renderEventList();
                } catch (error) {
                    console.error("ì´ë²¤íŠ¸ ì‚­ì œ ì˜¤ë¥˜:", error);
                    alert("ì´ë²¤íŠ¸ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            }
        }

        // --- í•¨ìˆ˜ ì „ì—­ í• ë‹¹ ---
        window.showListPage = showListPage;
        window.setSubFilter = setSubFilter;
        window.openModal = openModal;
        window.closeModal = closeModal;
        window.login = login;
        window.logout = logout;
        window.deleteAccount = deleteAccount;
        window.agreeAndSignUp = agreeAndSignUp;
        window.handleParticipation = handleParticipation;
        window.showDetailPage = showDetailPage;
        window.handleEventSubmit = handleEventSubmit;
        window.handleReportSubmit = handleReportSubmit;
        window.showAdminDashboard = showAdminDashboard;
        window.deleteEvent = deleteEvent;
        window.approveReport = approveReport;
        window.rejectReport = rejectReport;
        
        // --- ì´ˆê¸°í™” ---
        window.onload = () => {
            renderModals();
            onAuthStateChanged(auth, async (user) => {
                await handleUser(user);
                showListPage(mainFilter, subFilter);
            });
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });
        };
    </script>
</body>
</html>
