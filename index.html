<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¬¼íƒ€ê¸° ê³„ì‚°ê¸°(ì£¼ì‹/í•´ì™¸ì£¼ì‹/ì½”ì¸/ì„ ë¬¼)</title>
  <style>
    body {
      background-color: #fff;
      color: #222;
      font-family: 'Pretendard', sans-serif;
      padding: 20px;
      margin: auto;
      max-width: 600px;
    }
    h1 {
      text-align: center;
      color: #4CAF50;
      margin-bottom: 10px;
    }
    #exchangeBoard {
      position: fixed;
      top: 10px;
      right: 10px;
      background: linear-gradient(90deg, #000, #111);
      color: #0f0;
      padding: 10px 16px;
      font-size: 14px;
      font-weight: bold;
      border-radius: 10px;
      white-space: nowrap;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      border: 2px solid #0f0;
      z-index: 999;
    }
    select, input, button {
      width: 100%;
      padding: 14px;
      margin: 10px 0;
      border-radius: 8px;
      border: 2px solid #4CAF50;
      font-size: 16px;
      box-sizing: border-box;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    .result {
      margin-top: 20px;
      padding: 20px;
      background: #f7f7f7;
      border-radius: 10px;
      border: 1px solid #ddd;
    }
    .error {
      color: red;
      font-weight: bold;
      margin-top: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #ccc;
    }
    th {
      background-color: #f0f0f0;
    }
    @media screen and (max-width: 600px) {
      body {
        padding: 10px;
      }
      h1 {
        font-size: 20px;
      }
      input, button, select {
        font-size: 14px;
        padding: 10px;
      }
      #exchangeBoard {
        font-size: 12px;
        padding: 8px 12px;
      }
    }
  </style>
  <meta name="description" content="ë¬¼íƒ€ê¸° ê³„ì‚°ê¸° - ì£¼ì‹, ì½”ì¸, ì„ ë¬¼ê¹Œì§€ ë‹¤ì–‘í•œ íˆ¬ì ìì‚°ì˜ í‰ê· ë‹¨ê°€ì™€ ìˆ˜ìµë¥ ì„ ê³„ì‚°í•´ë³´ì„¸ìš”.">
  <meta name="keywords" content="ë¬¼íƒ€ê¸° ê³„ì‚°ê¸°, ì£¼ì‹, ì½”ì¸, ì„ ë¬¼, í‰ê· ë‹¨ê°€, ìˆ˜ìµë¥  ê³„ì‚°">
  <meta name="author" content="ParkGihyeon344">
</head>
<body>

<div id="exchangeBoard">USD/KRW: ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

<h1>ğŸ“Š ë¬¼íƒ€ê¸° ê³„ì‚°ê¸°</h1>

<label for="type">ê³„ì‚°ê¸° ì¢…ë¥˜ ì„ íƒ</label>
<select id="type" onchange="toggleType()">
  <option value="stock">ğŸ“ˆ ì£¼ì‹/í•´ì™¸ì£¼ì‹</option>
  <option value="coin">ğŸ’° ì½”ì¸</option>
  <option value="stockfut">ğŸ§­ ì£¼ì‹ì„ ë¬¼</option>
  <option value="coinfut">ğŸŒ ì½”ì¸ì„ ë¬¼</option>
</select>

<label>ğŸ“Œ ì¢…ëª©ëª…</label>
<input type="text" id="stockName" placeholder="ì˜ˆ: ë¹„íŠ¸ì½”ì¸, ì‚¼ì„±ì „ì" list="nameList">
<datalist id="nameList">
  <option value="ë¹„íŠ¸ì½”ì¸">
  <option value="ì´ë”ë¦¬ì›€">
  <option value="ì‚¼ì„±ì „ì">
  <option value="í…ŒìŠ¬ë¼">
  <option value="ì—ìŠ¤ì— ">
  <option value="ì—”ë¹„ë””ì•„">
</datalist>

<label>ğŸ“Š í˜„ì¬ ë³´ìœ  ìˆ˜ëŸ‰</label>
<input type="number" id="quantity" placeholder="ì˜ˆ: 0.5">

<label>ğŸ“‰ í˜„ì¬ ìˆ˜ìµë¥  (%)</label>
<input type="number" id="currentRate" placeholder="ì˜ˆ: -10">

<label>â• ì¶”ê°€ ë§¤ìˆ˜ ê¸ˆì•¡ (â‚©)</label>
<input type="number" id="addAmount" placeholder="ì˜ˆ: 50000">

<button onclick="calculate()">ë¬¼íƒ€ê¸° ê³„ì‚°í•˜ê¸°</button>

<div class="result" id="result"></div>
<div class="error" id="error"></div>

<script>
async function getExchangeRate() {
  try {
    const res = await fetch("https://api.exchangerate.host/latest?base=USD&symbols=KRW");
    const data = await res.json();
    if (data.rates && data.rates.KRW) {
      localStorage.setItem("lastExchangeRate", data.rates.KRW);
      return data.rates.KRW;
    } else {
      throw new Error("API êµ¬ì¡° ì˜¤ë¥˜");
    }
  } catch (e) {
    const cachedRate = localStorage.getItem("lastExchangeRate");
    if (cachedRate) {
      document.getElementById("exchangeBoard").innerText = `USD/KRW: â‚©${parseFloat(cachedRate).toLocaleString(undefined, {maximumFractionDigits:2})} (ì´ì „)`;
      return parseFloat(cachedRate);
    } else {
      document.getElementById("exchangeBoard").innerText = "í™˜ìœ¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
      return 1350;
    }
  }
}

getExchangeRate().then(rate => {
  if (rate) {
    document.getElementById("exchangeBoard").innerText = `USD/KRW: â‚©${rate.toLocaleString(undefined, {maximumFractionDigits:2})}`;
  }
});

function toggleType() {
  const type = document.getElementById("type").value;
  const label = document.querySelector("label[for='type']");
  if (type === 'coin') label.textContent = "ì½”ì¸ëª…";
  else if (type === 'stock') label.textContent = "ì¢…ëª©ëª…";
  else if (type === 'stockfut') label.textContent = "ì£¼ì‹ì„ ë¬¼ëª…";
  else if (type === 'coinfut') label.textContent = "ì½”ì¸ì„ ë¬¼ëª…";
}

function calculate() {
  const name = document.getElementById("stockName").value.trim();
  const quantity = Number(document.getElementById("quantity").value);
  const rate = Number(document.getElementById("currentRate").value);
  const addAmount = Number(document.getElementById("addAmount").value);

  const errorDiv = document.getElementById("error");
  const resultDiv = document.getElementById("result");
  errorDiv.innerText = "";
  resultDiv.innerHTML = "";

  if (!name || !quantity || isNaN(rate) || !addAmount) {
    errorDiv.innerText = "â— ëª¨ë“  ì…ë ¥ê°’ì„ ì±„ì›Œì£¼ì„¸ìš”.";
    return;
  }

  const nowPrice = (quantity * 100) / (100 + rate);
  const originalTotal = nowPrice * quantity;
  const additionalQty = addAmount / nowPrice;
  const totalQty = quantity + additionalQty;
  const newTotal = originalTotal + addAmount;
  const newVal = nowPrice * totalQty;
  const newRate = ((newVal - newTotal) / newTotal) * 100;
  const profit = newVal - newTotal;

  resultDiv.innerHTML = `
    <table>
      <thead>
        <tr>
          <th>ì¢…ëª©ëª…</th>
          <th>í‰ê°€ì†ìµ</th>
          <th>ìˆ˜ìµë¥ </th>
          <th>ë³´ìœ ìˆ˜ëŸ‰</th>
          <th>í‰ê°€ê¸ˆì•¡</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>${name}</td>
          <td style="color:${profit >= 0 ? 'blue' : 'red'}">â‚©${profit.toLocaleString(undefined, {maximumFractionDigits:0})}</td>
          <td style="color:${newRate >= 0 ? 'blue' : 'red'}">${newRate.toFixed(2)}%</td>
          <td>${totalQty.toFixed(4)}ë‹¨ìœ„</td>
          <td>â‚©${newVal.toLocaleString(undefined, {maximumFractionDigits:0})}</td>
        </tr>
      </tbody>
    </table>
  `;
}
</script>

</body>
</html>
